<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Software &mdash; Tower Next Generation Software Data Processing  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Data" href="data.html" />
    <link rel="prev" title="Hardware" href="hardware.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Tower Next Generation Software Data Processing
            <img src="_static/NOAA.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="dataacq.html">GGGRN In-Situ Data Acquisition</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="dataacq.html#topics">Topics</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="hardware.html">Hardware</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Software</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-acquisition-programs">Data acquisition programs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#additional-programs-and-modules">Additional programs and modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#list-of-python-files">List of Python files</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="data.html">Data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="datafiles.html">Analyer Data Files</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Tower Next Generation Software Data Processing</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="dataacq.html">GGGRN In-Situ Data Acquisition</a> &raquo;</li>
      <li>Software</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/software.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="software">
<h1>Software<a class="headerlink" href="#software" title="Permalink to this headline"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<img alt="_images/software.png" src="_images/software.png" />
<p>Control and data acquistion of the measurement system is done with laptop computer running
the Linux operating system, and using several python programs.  The programs depend on several
configuration files, and short-term results are stored in a sqlite3 relational database.  Long-term
results are fetched from the database and stored in text files.  These text files are transferred
back to GML headquarters in Boulder, Coloraod, where the data is processed.  A user interface to
the measurement system is provided using a web browser and a web server on the linux laptop.</p>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline"></a></h2>
<p>Configuration files:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 77%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Default Name</p></th>
<th class="head"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ccg.ini</p></td>
<td><p>System configuration</p></td>
</tr>
<tr class="row-odd"><td><p>ccg.conf</p></td>
<td><p>For hm program</p></td>
</tr>
<tr class="row-even"><td><p>qcchannels</p></td>
<td><p>Sensor configuration</p></td>
</tr>
<tr class="row-odd"><td><p>qc.conf</p></td>
<td><p>For hm program doing qc data acquisition</p></td>
</tr>
</tbody>
</table>
<section id="system-configuration">
<h3>System Configuration<a class="headerlink" href="#system-configuration" title="Permalink to this headline"></a></h3>
<p>Several configuration files are used.  The main one is for the configuration of the
main data acquisition program <code class="docutils literal notranslate"><span class="pre">ccg.py</span></code>.  The file (by default called <code class="docutils literal notranslate"><span class="pre">ccg.ini</span></code>) specifies
a number of things, such as the reference gases used, the type of analyzer, timing of
when gases are sampled etc.</p>
<p>This configuration file uses a format that can be read by python’s <a class="reference external" href="https://docs.python.org/3/library/configparser.html">configparser</a> module.
However, because the web interface php programs also read the configuration file, the file
must be compatible with php’s <code class="docutils literal notranslate"><span class="pre">parse_ini_file</span></code> routine which puts some restrictions on the
format of the file (comments must be preceeded by ‘;’, and
the ‘=’ sign is used as the separator).</p>
<p>The file is made up of sections marked by a [section] header line. This is followed by
key/value pairs separated by an ‘=’ sign.  There is a <code class="docutils literal notranslate"><span class="pre">[DEFAULT]</span></code> section, a section for
the system (e.g. <code class="docutils literal notranslate"><span class="pre">[CRDS]</span></code>), a section for the analyzer (<code class="docutils literal notranslate"><span class="pre">[PICARRO]</span></code>) and a section for the
qc measurement system (<code class="docutils literal notranslate"><span class="pre">[QC]</span></code>).</p>
<p>An example looks like</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[DEFAULT]</span>
<span class="c1">; this is the system to be used. Only one allowed</span>
<span class="c1">; There must be a section with the same name</span>
<span class="na">system</span> <span class="o">=</span> <span class="s">CRDS</span>

<span class="na">stacode</span> <span class="o">=</span> <span class="s">MLO</span>

<span class="na">HOMEDIR</span>        <span class="o">=</span> <span class="s">/home/ccg</span>
<span class="na">ref_gases</span> <span class="o">=</span> <span class="s">R0, S1, S2, S3, S4, TGT</span>
<span class="na">sample_gases</span> <span class="o">=</span> <span class="s">Line1, Line2</span>

<span class="c1">;--------------------------------------------------</span>
<span class="k">[CRDS]</span>
<span class="c1">; what analyzer is to be used.  There must be a section with this name</span>
<span class="na">analyzer</span> <span class="o">=</span> <span class="s">PICARRO</span>
<span class="na">ref_gases</span> <span class="o">=</span> <span class="s">R0, S1, S2, S3, S4, S5, TGT1, TGT2</span>

<span class="c1">; Automatically run a target gas at the following interval</span>
<span class="na">TARGET_INTERVAL</span> <span class="o">=</span> <span class="s">11</span>
<span class="na">TARGET_INTERVAL_UNITS</span> <span class="o">=</span> <span class="s">hours</span>

<span class="c1">;--------------------------------------------------</span>
<span class="c1">; analyzer specific settings</span>
<span class="k">[PICARRO]</span>

<span class="na">gases</span> <span class="o">=</span> <span class="s">CO2, CH4, CO</span>
<span class="c1">;</span>
<span class="c1">; location in the output string where the gas value is located.</span>
<span class="c1">; comma separated string containing value for each gas</span>
<span class="na">gas_field_num</span> <span class="o">=</span> <span class="s">31, 34, 28</span>

<span class="k">[QC]</span>

<span class="c1"># Our home</span>
<span class="na">HOMEDIR</span> <span class="o">=</span> <span class="s">/home/ccg/qc</span>

<span class="c1"># sensor info. This is file name located in homedir</span>
<span class="na">qc_table</span> <span class="o">=</span> <span class="s">mlo_qc.conf</span>
</pre></div>
</div>
</section>
<section id="sensor-configuration">
<h3>Sensor Configuration<a class="headerlink" href="#sensor-configuration" title="Permalink to this headline"></a></h3>
<p>A separate configuration file is used to specify the name, types, and locations, of the
various sensor that are used for measuring the quality control (QC) signals.</p>
<p>Example</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># Number: Device: Channel number: Name:         Units:    Field Name:     Location:  Sublocation:  Interval between readings (s): Min limit: Max limit</span>
<span class="c1"># Set interval to 0 to skip taking readings from that sensor</span>
<span class="c1">#------------------------------------------------------------------</span>
<span class="na">1:  hp34970: 201: Inlet 1 Bleed Flow Rate:      L/min:    bleed_flow:      inlet:      1:            30:    1: 999</span>
<span class="na">2:  hp34970: 203: Inlet 1 Back Pressure:        psia:     back_pressure:   inlet:      1:            30:    4: 8</span>
<span class="c1">#</span>
<span class="na">3:  hp34970: 202: Inlet 2 Bleed Flow Rate:      L/min:    bleed_flow:      inlet:      2:            30:    1: 999</span>
<span class="na">4:  hp34970: 204: Inlet 2 Back Pressure:        psia:     back_pressure:   inlet:      2:            30:    4: 8</span>
<span class="c1">#</span>
<span class="na">5:  hp34970: 205: Sample Pressure:              torr:     sample_pressure: instrument: picarro:      30:  680: 720</span>
<span class="na">6:  hp34970: 206: Sample Flow Rate:             cc/min:   sample_flow:     instrument: picarro:      30:   50: 200</span>
<span class="na">7:  hp34970: 212: Room Temperature:             deg. C:   temperature:     misc:       room:         30:    0: 40</span>
<span class="na">8:  hp34970: 214: Water Trap Temperature:       deg. C:   temperature:     misc:       trap:         30: -100: -40</span>
<span class="c1">#</span>
<span class="na">9:  none:   0: R0 Tank Pressure:             psi:      pressure:        tank:       R0:           0:   300: 2500</span>
<span class="na">10: none:   0: S1 Tank Pressure:             psi:      pressure:        tank:       S1:           0:   300: 2500</span>
<span class="na">11: none:   0: S2 Tank Pressure:             psi:      pressure:        tank:       S2:           0:   300: 2500</span>
<span class="na">12: none:   0: S3 Tank Pressure:             psi:      pressure:        tank:       S3:           0:   300: 2500</span>
<span class="na">13: none:   0: S4 Tank Pressure:             psi:      pressure:        tank:       S4:           0:   300: 2500</span>
<span class="na">14: none:   0: S5 Tank Pressure:             psi:      pressure:        tank:       S5:           0:   300: 2200</span>
<span class="na">15: none:   0: TGT1 Tank Pressure:           psi:      pressure:        tank:       TGT1:         0:   300: 2500</span>
<span class="na">16: none:   0: TGT2 Tank Pressure:           psi:      pressure:        tank:       TGT2:         0:   300: 2500</span>
<span class="c1">#</span>
<span class="na">17:    none:   0: Cavity Pressure:              torr:     cavity_pressure: instrument: picarro:      0: 139.9: 140.1</span>
<span class="na">18:    none:   0: Cavity Temperature:           deg. C:   cavity_temp:     instrument: picarro:      0:  44.9: 45.1</span>
<span class="na">19:    none:   0: DAS Temperature:              deg. C:   das_temp:        instrument: picarro:      0:    39: 42</span>
<span class="na">20:    none:   0: Etalon Temperature:           deg. C:   etalon_temp:     instrument: picarro:      0:  44.7: 44.8</span>
<span class="na">21:    none:   0: Warmbox Temperature:          deg. C:   warmbox_temp:    instrument: picarro:      0:  44.9: 45.1</span>
<span class="na">22:    none:   0: CRDS Water Vapor:             ppm:      water_vapor:     instrument: picarro:      0: -0.01: 0.01</span>
</pre></div>
</div>
</section>
</section>
<section id="data-acquisition-programs">
<h2>Data acquisition programs<a class="headerlink" href="#data-acquisition-programs" title="Permalink to this headline"></a></h2>
<p>Data acquisition is broken down into two main python programs, <code class="docutils literal notranslate"><span class="pre">ccg.py</span></code> and <code class="docutils literal notranslate"><span class="pre">qc.py</span></code>.  These programs run
independently of each other.  Several python modules are included and the actual communications with the devices
is done using a python program called <code class="docutils literal notranslate"><span class="pre">hm.py</span></code>.  <span class="xref std std-ref">Documentation on hm is available here.</span></p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>ccg.py</dt><dd><ul>
<li><dl class="simple">
<dt>ccg_control.py</dt><dd><ul>
<li><p>runaction</p></li>
<li><p>utils</p></li>
<li><p>db</p></li>
<li><p>hm</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>ccg_monitor.py</dt><dd><ul>
<li><p>db</p></li>
<li><p>utils.py</p></li>
<li><p>hm</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>qc.py</dt><dd><ul>
<li><dl class="simple">
<dt>qcscan.py</dt><dd><ul>
<li><p>utils</p></li>
<li><p>db</p></li>
<li><p>runaction</p></li>
<li><p>lock_file</p></li>
<li><p>utils</p></li>
<li><p>hm</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="additional-programs-and-modules">
<h2>Additional programs and modules<a class="headerlink" href="#additional-programs-and-modules" title="Permalink to this headline"></a></h2>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>ccgis.py - General purpose processing</dt><dd><ul>
<li><p>insitu</p></li>
<li><p>refgas</p></li>
<li><p>response</p></li>
<li><p>rawfiles</p></li>
<li><p>utils</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>db.py - database interface</p></li>
<li><p>mk_sensor_table.py - create and populate the sensors database table</p></li>
<li><p>sample_gas.py - manually control the gas flowing through the system</p></li>
<li><p>hm.py</p></li>
<li><p>fetchdb.py</p></li>
<li><p>fetchqc.py</p></li>
<li><p>fetchlog.py</p></li>
<li><p>fetchtanks.py</p></li>
<li><p>cleandb.py</p></li>
</ul>
</div></blockquote>
</section>
<section id="list-of-python-files">
<h2>List of Python files<a class="headerlink" href="#list-of-python-files" title="Permalink to this headline"></a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 62%" />
<col style="width: 13%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>File name</p></th>
<th class="head"><p>Purpose</p></th>
<th class="head"><p>Used by</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ccg.py</p></td>
<td><p>Main data acquistion program for insitu system</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>ccg_control.py</p></td>
<td><p>Control gases sampled in system</p></td>
<td><p>ccg.py</p></td>
</tr>
<tr class="row-even"><td><p>ccg_monitor.py</p></td>
<td><p>Monitor output from analyzer</p></td>
<td><p>ccg.py</p></td>
</tr>
<tr class="row-odd"><td><p>qc.py</p></td>
<td><p>Main data acquisition program for qc signals</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>qcscan.py</p></td>
<td><p>Module for qc.py</p></td>
<td><p>qc.py</p></td>
</tr>
<tr class="row-odd"><td><p>hm.py</p></td>
<td><p>Hardware manager, communicate with devices</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>ccgis.py</p></td>
<td><p>Process data</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>changemode.py</p></td>
<td><p>Manually change measurement mode</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>cleandb.py</p></td>
<td><p>Remove old data from database</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>dates.py</p></td>
<td><p>Date conversion functions</p></td>
<td><p>multiple</p></td>
</tr>
<tr class="row-even"><td><p>db.py</p></td>
<td><p>Database interface class</p></td>
<td><p>multiple</p></td>
</tr>
<tr class="row-odd"><td><p>fetchdb.py</p></td>
<td><p>Fetch analyzer data from database</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>fetchlog.py</p></td>
<td><p>Fetch operator logs from database</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>fetchqc.py</p></td>
<td><p>Fetch qc data from database</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>fetchtanks.py</p></td>
<td><p>Fetch reference tank info from database</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>insitu.py</p></td>
<td><p>Calculate mole fractions</p></td>
<td><p>ccgis.py</p></td>
</tr>
<tr class="row-even"><td><p>lock_file.py</p></td>
<td><p>Lock a file</p></td>
<td><p>hm.py</p></td>
</tr>
<tr class="row-odd"><td><p>mean.py</p></td>
<td><p>Mean and standard deviation functions</p></td>
<td><p>multiple</p></td>
</tr>
<tr class="row-even"><td><p>mk_sensor_table.py</p></td>
<td><p>Create sensor database table</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>rawfiles.py</p></td>
<td><p>Create ‘raw’ file data lines</p></td>
<td><p>ccgis.py</p></td>
</tr>
<tr class="row-even"><td><p>refgastab.py</p></td>
<td><p>Get reference gas info</p></td>
<td><p>ccgis.py</p></td>
</tr>
<tr class="row-odd"><td><p>response.py</p></td>
<td><p>Analyzer response functions</p></td>
<td><p>ccgis.py</p></td>
</tr>
<tr class="row-even"><td><p>runaction.py</p></td>
<td><p>Handle action files for hm</p></td>
<td><p>hm.py</p></td>
</tr>
<tr class="row-odd"><td><p>samplegas.py</p></td>
<td><p>Manually sample a gas</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>schema.py</p></td>
<td><p>Create database tables</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>utils.py</p></td>
<td><p>Utility functions</p></td>
<td><p>multiple</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="hardware.html" class="btn btn-neutral float-left" title="Hardware" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="data.html" class="btn btn-neutral float-right" title="Data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Kirk Thoning.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>